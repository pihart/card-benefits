<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Credit Card Benefit Tracker</title>

    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">

    <link rel="stylesheet" href="css/components/modals.css">
    <link rel="stylesheet" href="css/components/forms.css">
    <link rel="stylesheet" href="css/components/expiring-soon.css">
    <link rel="stylesheet" href="css/components/cards.css">
    <link rel="stylesheet" href="css/components/benefits.css">
    <link rel="stylesheet" href="css/components/ai.css">
</head>
<body>

<header>
    <div class="header-content">
        <div style="display: flex; align-items: center; gap: 15px;">
            <h1>üí≥ Benefit Tracker</h1>
            <div id="loading-indicator" class="spinner" style="display: none;"></div>
        </div>
        <div style="display: flex; align-items: center; gap: 15px;">
            <button id="settings-btn" class="secondary-btn">‚öôÔ∏è Settings</button>
        </div>
    </div>
</header>

<div class="page-layout">

    <aside class="sidebar-content">
        <section id="expiring-soon-container" class="expiring-soon-container">
            <details class="expiring-widget-details" open>
                <summary class="expiring-widget-summary">üî• Expiring Soon</summary>
                <div class="expiring-content-wrapper">
                    <div class="expiring-controls">
                        <div class="form-group">
                            <label for="expiring-days-select">Expires in:</label>
                            <select id="expiring-days-select">
                                <option value="7">7 Days</option>
                                <option value="14">14 Days</option>
                                <option value="30" selected>30 Days</option>
                                <option value="60">60 Days</option>
                                <option value="90">90 Days</option>
                                <option value="120">120 Days</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="expiring-min-amount">Min value:</label>
                            <input id="expiring-min-amount" type="number" min="0" step="1" value="0">
                        </div>
                    </div>
                    <ul id="expiring-active-list" class="expiring-list"></ul>
                    <div id="expiring-subsections"></div>
                </div>
            </details>

        </section>

    </aside>

    <main>
        <section id="card-list-container">
        </section>

        <section class="add-card-container">
            <button id="show-add-card-btn" class="secondary-btn show-add-card-btn">Add a New Card</button>

            <div class="card-form-container" style="display: none;">
                <h2>Add a New Card</h2>
                <form id="add-card-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-card-name">Card Name</label>
                            <input type="text" id="new-card-name" placeholder="E.g., Amex Gold" required>
                        </div>
                        <div class="form-group">
                            <label for="new-card-anniversary">Anniversary Date</label>
                            <input type="date" id="new-card-anniversary" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <button type="submit">Add Card</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Reset Confirmation Modal -->
        <div id="reset-modal" class="modal-overlay">
            <div class="modal-content">
                <h2>Benefits Ready to Reset</h2>
                <p>The following benefits have completed their cycle and are ready to be reset to $0 used:</p>
                <ul id="modal-reset-list" class="modal-list"></ul>
                <div class="modal-actions">
                    <button id="modal-cancel" class="secondary-btn">Cancel</button>
                    <button id="modal-ok">Reset Benefits</button>
                </div>
            </div>
        </div>

         <!-- Settings/Storage Modal -->
        <div id="settings-modal" class="modal-overlay">
            <div class="modal-content">
                <h2>Settings</h2>
                
                <h3 style="margin-top: 0; margin-bottom: 10px; font-size: 1rem; color: #555;">Display Options</h3>
                <div class="form-group">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="collapse-sections-checkbox" style="width: auto;">
                        <label for="collapse-sections-checkbox" style="margin: 0;">Group fully utilized/ignored items into collapsible sections</label>
                    </div>
                    <small style="color: #666;">When enabled, fully utilized and ignored benefits will be grouped into separate collapsed sections within each card, similar to the expiring soon widget.</small>
                </div>
                <div class="form-group">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <input type="checkbox" id="hide-monthly-expiring-checkbox" style="width: auto;">
                        <label for="hide-monthly-expiring-checkbox" style="margin: 0;">Hide monthly recurring benefits from Expiring Soon</label>
                    </div>
                    <small style="color: #666;">Enable to remove monthly reset benefits from the Expiring Soon widget.</small>
                </div>
                
                <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1rem; color: #555;">Custom Date Override</h3>
                <div class="form-group">
                    <label for="custom-date-input">Override Current Date</label>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <input type="date" id="custom-date-input" style="flex: 1;">
                        <button id="clear-custom-date-btn" class="secondary-btn" type="button">Use Real Date</button>
                    </div>
                    <small style="color: #666;">Set a custom date to simulate a different day. Leave empty to use the real current date.</small>
                </div>

                <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1rem; color: #555;">Data Storage</h3>
                <p style="margin-top: 0;">Configure where your data is saved. <br><small>Current: <b id="current-storage-type">Local
                    Storage</b></small></p>

                <div class="form-group">
                    <label for="s3-url-input">Object Storage URL (JSON)</label>
                    <input type="text" id="s3-url-input"
                           placeholder="https://objectstorage.us-ashburn-1.oraclecloud.com/p/TOKEN/n/NAMESPACE/b/BUCKET/o/data.json">
                    <small style="color: #666;">Provide a pre-authenticated URL (PAR) that allows read/write
                        access.</small>
                </div>

                <div class="form-group">
                    <label for="poll-interval-input">Cloud Poll Interval (ms)</label>
                    <input type="number" id="poll-interval-input" placeholder="800" min="100" step="100">
                    <small style="color: #666;">How frequently to check for updates from other devices (Default:
                        800ms).</small>
                </div>

                <h3 style="margin-top: 20px; margin-bottom: 10px; font-size: 1rem; color: #555;">AI Assistant</h3>
                <p id="ai-settings-status" style="margin: 0 0 8px 0;">Checking on-device model availability...</p>
                <div id="ai-download-progress" class="ai-download-progress" style="display: none;">
                    <div id="ai-download-bar"></div>
                </div>
                <small id="ai-download-note" style="color: #666;">If a local model is required, it will download in the background and you can track progress here.</small>

                <div class="modal-actions" style="justify-content: space-between;">
                    <button id="use-local-storage-btn" class="secondary-btn">Reset to Local Storage</button>
                    <div style="display: flex; gap: 10px;">
                        <button id="settings-cancel" class="secondary-btn">Cancel</button>
                        <button id="settings-save">Save & Connect</button>
                    </div>
                </div>
            </div>
        </div>

        <section id="ai-assistant" class="ai-assistant">
            <div class="ai-assistant-header">
                <div>
                    <h2 style="margin: 0;">AI Assistant</h2>
                    <p id="ai-availability" class="ai-status">Checking model...</p>
                </div>
                <div class="ai-summary-controls">
                    <button id="ai-refresh-summary" class="secondary-btn" type="button">Refresh Summary</button>
                </div>
            </div>

            <div class="ai-summary-panel">
                <div class="ai-summary-title">AI Summary &amp; Priorities</div>
                <div id="ai-summary" class="ai-summary-body">Model loading...</div>
            </div>

            <div class="ai-chat">
                <div class="ai-messages-wrapper">
                    <div id="ai-messages" class="ai-messages"></div>
                </div>
                <div id="ai-intent" class="ai-intent-label"></div>
                <form id="ai-chat-form" class="ai-chat-form">
                    <input type="text" id="ai-input" placeholder="Ask a question or request an update (e.g., mark airline credits as used)" required>
                    <button type="submit">Send</button>
                </form>
            </div>
        </section>

    </main>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

<script src="storageInterface.js"></script>
<script src="localStorageStore.js"></script>
<script src="cloudStore.js"></script>
<script src="models/ExpiryCycle.js"></script>
<script src="models/CarryoverCycle.js"></script>
<script src="models/MinimumSpend.js"></script>
<script src="models/Benefit.js"></script>
<script src="models/Card.js"></script>
<script src="dateUtils.js"></script>
<script src="dataSchema.js"></script>
<script src="aiAssistant.js"></script>
<script src="uiRenderer.js"></script>
<script src="app.js"></script>
</body>
</html>
